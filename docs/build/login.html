

<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Iniciar sesión &mdash; documentación de Mafaldos - 0.0.2</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Perfil" href="mi%20Perfil.html" />
    <link rel="prev" title="Registro" href="registro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Mafaldos
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="descripcion.html">Descripción</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="componentes.html">Estructura</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sidenav.html">Sidenav</a></li>
<li class="toctree-l2"><a class="reference internal" href="home.html">Inicio</a></li>
<li class="toctree-l2"><a class="reference internal" href="registro.html">Registro</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Iniciar sesión</a></li>
<li class="toctree-l2"><a class="reference internal" href="mi%20Perfil.html">Perfil</a></li>
<li class="toctree-l2"><a class="reference internal" href="equipo.html">Equipo</a></li>
<li class="toctree-l2"><a class="reference internal" href="registros.html">Registros</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html">Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="contacto.html">Contacto</a></li>
<li class="toctree-l2"><a class="reference internal" href="angularMaterial.html">Angular Material</a></li>
<li class="toctree-l2"><a class="reference internal" href="usuarioModel.html">Modelo registros</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Servicio Auth</a></li>
<li class="toctree-l2"><a class="reference internal" href="contactoService.html">Servicio Contacto</a></li>
<li class="toctree-l2"><a class="reference internal" href="APIREST.html">Servicio Municipios</a></li>
<li class="toctree-l2"><a class="reference internal" href="registrosService.html">Servicio Registros</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Mafaldos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="componentes.html">Estructura</a> &raquo;</li>
        
      <li>Iniciar sesión</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/login.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="iniciar-sesion">
<h1>Iniciar sesión<a class="headerlink" href="#iniciar-sesion" title="Enlazar permanentemente con este título">¶</a></h1>
<img alt="_images/login.JPG" src="_images/login.JPG" />
<p>Inicio de sesión</p>
<ul class="simple">
<li><p>Descripción</p></li>
</ul>
<p>Este componente de Login, está compuesto por contenedor, el cuál con la propiedades del fxFlex podemos otorgarle un re-dimencionamiento a nuestro componente dependiendo de la pantalla de nuestro usuario. Se desarrolla a modo de formulario, en el cuál posee un pequeño titulo que identifica dicha sección. dentro de nuestro formulario, solo tenemos un input de e-mail &amp; un botón que tendrá el método onLogin(), el cuál validará si el correo existe o no en base de datos. y si el usuario no posee una cuenta, un hipervínculo que lo ayudará a registrarse en nuestra plataforma.</p>
<ul class="simple">
<li><p>Importaciones</p></li>
</ul>
<p>Para este componente, son fundamentales las importaciones del FormControl, FormGroup &amp; Validators, para poder crear nuestro formulario y poder enviar todos los datos que este capture.</p>
<p>El authService nos ayudará para verificar la autenticidad de los datos entregados, permitiendonos saber si el cliente existe. Se importa Registro Services que es donde tenemos todos nuestros métodos para interactuar con nuestra base de datos. se importan los Mat Dialog para poder manejar los Modales.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span> <span class="n">Component</span><span class="p">,</span> <span class="n">OnInit</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@angular/core&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">FormControl</span><span class="p">,</span> <span class="n">FormGroup</span><span class="p">,</span> <span class="n">Validators</span><span class="p">,</span> <span class="n">EmailValidator</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@angular/forms&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">Router</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@angular/router&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">auth</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;firebase&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">AuthService</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;../../services/auth.service&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">RegistrosService</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;src/app/services/registros.service&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">MatDialogConfig</span><span class="p">,</span> <span class="n">MatDialog</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@angular/material/dialog&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">DialogComponent</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;../dialog/dialog.component&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">AngularFireAuth</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@angular/fire/auth&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>Desarrollo</dt><dd><p>En esta sección, iniciamos con nuestro componente creado en el HTML y estilizado en nuestro css.</p>
</dd>
</dl>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;div
  class=&quot;content&quot;
  fxLayout=&quot;row wrap&quot;
  fxLayoutGap=&quot;16px grid&quot;
  fxLayoutAlign=&quot;center center&quot;&gt;
  &lt;div fxFlex=&quot;30%&quot; fxFlex.xs=&quot;100%&quot; fxFlex.sm=&quot;33%&quot;&gt;
  &lt;div class=&quot;login-form&quot;&gt;
    &lt;mat-card&gt;
      &lt;mat-card-content&gt;
        &lt;mat-card-title&gt;Iniciar sesión&lt;/mat-card-title&gt;
        &lt;p&gt;&lt;/p&gt;

        &lt;form [formGroup]=&quot;loginForm&quot; (ngSubmit)=&quot;onLogin()&quot;&gt;
          &lt;mat-form-field appearance=&quot;outline&quot;&gt;
            &lt;mat-label&gt;Email&lt;/mat-label&gt;
            &lt;input matInput type=&quot;text&quot; formControlName=&quot;email&quot; required /&gt;
          &lt;/mat-form-field&gt;

          &lt;p&gt;&lt;/p&gt;
          &lt;button type=&quot;submit&quot; mat-raised-button&gt;Iniciar&lt;/button&gt;
        &lt;/form&gt;
        &lt;p&gt;&lt;/p&gt;
        &lt;p&gt;
          ¿Aún no tienes una cuenta?&lt;a [routerLink]=&quot;[&#39;/register&#39;]&quot;&gt;
            Regístrate&lt;/a
          &gt;
        &lt;/p&gt;
      &lt;/mat-card-content&gt;
    &lt;/mat-card&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</pre></div>
</div>
<p>El desarrollo de nuestra lógica de desarrollo empieza por la creación de nuestro Form en el typescript</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loginForm</span><span class="o">=</span> <span class="n">new</span> <span class="n">FormGroup</span><span class="p">({</span>
  <span class="n">emai</span><span class="p">:</span> <span class="n">new</span> <span class="n">FormControl</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,[</span><span class="n">Validators</span><span class="o">.</span><span class="n">required</span><span class="p">,</span> <span class="n">Validators</span><span class="o">.</span><span class="n">email</span><span class="p">])</span>

<span class="p">})</span>
</pre></div>
</div>
<p>Después de que tenemos nuestro Form listo para recibir información, podemos ir a nuestro método principal en donde vamos a primero, validar si el correo que se ingresó existe en nuestra base de datos, si sí, se usar el router para redirigir el usuario a Home. sino saldrá un Modal explicando que no existe este correo en nuestra base de datos.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="k">async</span> <span class="n">onLogin</span><span class="p">(){</span>
  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;funciona&quot;</span><span class="o">+</span> <span class="n">this</span><span class="o">.</span><span class="n">loginForm</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">value</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">ValidarExistenciaCorreo</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">loginForm</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">==</span><span class="n">true</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">const</span> <span class="n">user</span><span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">authSvc</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">loginForm</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
      <span class="n">this</span><span class="o">.</span><span class="n">loginForm</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">value</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span><span class="n">redirect</span> <span class="n">to</span> <span class="n">homePage</span>
    <span class="n">this</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">navigate</span><span class="p">([</span><span class="s1">&#39;/home&#39;</span><span class="p">])</span>
  <span class="p">}</span>


    <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="o">//</span><span class="n">window</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="s1">&#39;correo no registrado&#39;</span><span class="p">);</span>
    <span class="n">const</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span> <span class="n">titulo</span><span class="p">:</span><span class="s1">&#39;Advertencia&#39;</span><span class="p">,</span> <span class="n">mensaje</span><span class="p">:</span><span class="s1">&#39;El correo no esta registrado en la BD&#39;</span><span class="p">};</span>
    <span class="n">this</span><span class="o">.</span><span class="n">openDialog</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

  <span class="p">}</span>


<span class="p">}</span>
</pre></div>
</div>
<p>Como podemos observar, nuestro método onLogin, se vale de un Método llamado ValidarExistenciaCorreo, el cual es un método que espera un String y un Boolean. en este método, recorremos una lista de registros con un for y vamos comparando el String(correo) que nos entrega nuestro usuario final y lo comparamos con cada dato de correo existente en la base de datos</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">let</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">this</span><span class="o">.</span><span class="n">listaRegistros</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="n">const</span> <span class="n">element</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">listaRegistros</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

<span class="n">const</span> <span class="p">{</span> <span class="n">email</span> <span class="p">}</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">correo</span> <span class="o">==</span> <span class="n">email</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">existeCorreo</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">}</span>


<span class="k">if</span> <span class="p">(</span><span class="n">existeCorreo</span> <span class="o">==</span> <span class="n">true</span><span class="p">)</span> <span class="p">{</span>


  <span class="n">respuesta</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>

<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
  <span class="n">respuesta</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
<span class="p">}</span>

  <span class="k">return</span> <span class="n">respuesta</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>por último, tenemos nuestro modal, el cuál es el método OpenDialog y recibe una variable data que puede ser cualquier tipo de dato. y es la que mostrará un mensaje una vez tengamos el correo erroneo.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>openDialog(data:any) {
  const dialogConfig = new MatDialogConfig();
  dialogConfig.data = data;
//dialogConfig.data = { titulo:&#39;Estado de registro&#39;, mensaje:&#39;Exitoso&#39;};
  let dialogRef = this.matDialog.open(DialogComponent, dialogConfig)
  dialogRef.afterClosed().subscribe(value =&gt; {
  this.resDialog=value;
  console.log(`Dialog sent: ${value}`);
  });;
  }
  }
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mi%20Perfil.html" class="btn btn-neutral float-right" title="Perfil" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="registro.html" class="btn btn-neutral float-left" title="Registro" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Carlos Gonzalez &amp; Yeison Rey

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>